<div id="mymodal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Title</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <form action="">
          <table class="table table-sm table-light table-hover">
            <thead class="thead-light">
              <tr class="text-center">
                <th scope="col" class="w-50">Атауы</th>
                <th scope="col">Диаметрі</th>
                <th scope="col">Ұзындығы</th>
                <th scope="col"></th>
              </tr>
            </thead>
            <tbody class="tbody">
              <tr>
                <td><input type="text" class="form-control form-control-sm" list="pipes_list" name="pipe[]" required></td>
                <td><input type="number" class="form-control form-control-sm text-right" name="diameter[]" step="1" min="50" max="120" required></td>
                <td><input type="number" class="form-control form-control-sm text-right" name="length[]" step="0.1" min="0.1" max="6" required></td>
                <td class="text-right"><i class="far fa-trash-alt"></i></td>
              </tr>
              <tr class="addrow">
                <td colspan=4><a class="btn btn-sm btn-outline-info" href="#">Тағы да...</a><button type="submit" name="template" hidden></button></td>
              </tr>
            </tbody>
          </table>
          <datalist id="pipes_list" class="current"></datalist>
        </form>


      </div>
      <div class="modal-footer">
        <button id="" type="button" class="btn btn-secondary btn-sm fst_btn_caption" data-dismiss="modal">Close</button>
        <button id="" type="button" class="btn btn-primary btn-sm sec_btn_caption">Save</button>
      </div>
    </div>
  </div>
</div>

<script>
  function init(container) {
    var modalname = '#mymodal';

    var opt = {
      title: "Трубаның жаңа түрін енгізу",
      fst_btn_caption: "Жабу",
      sec_btn_caption: "Өзің біл"
    };

    $.post('/pipenames', function (data) {
      data.forEach(element => {
        $(container + ' .current:first').append(`<option value="${element.pipe}">`);
      });
      // $(container + ' .current:first').removeClass('current');
    });

    $(container + ' .modal-title').text(opt.title);
    $(container + ' .fst_btn_caption').text(opt.fst_btn_caption);
    $(container + ' .sec_btn_caption').text(opt.sec_btn_caption);

    var submitButton = $(container + ' button').filter('[name="template"]');

    submitButton.click(function (e) {
      isValid = $(container + ' form')[0].checkValidity();

      if (false === isValid) return true;
      // true деп қайтармасаң валидацияны көрсетпейді
      e.preventDefault();

      $.ajax({
        method: 'POST',
        url: '/test',
        data: $(container + ' form').serialize(),
        success: function (res, sts, xhr) {
          $(container + ' ' + modalname).modal('hide');
        },
        error: function (xhr, sts, err) {
          alert('Server not response', err);
        }
      });
    });

    $(container + ' .sec_btn_caption').on('click', function () {
      submitButton.trigger('click');
    });

    $(container + ' .tbody .btn').click(function () {
      var tableRow = '<tr><td><input type="text" class="form-control form-control-sm" list="pipes_list" name="pipe[]" required></td>' +
        '<td><input type="number" class="form-control form-control-sm text-right" name="diameter[]" step="1" min="50" max="120" required></td>' +
        '<td><input type="number" class="form-control form-control-sm text-right" name="length[]" step="0.1" min="0.1" max="6" required></td>' +
        '<td class="text-right"><i class="far fa-trash-alt"></i></td></tr>';

      $(container + ' .addrow').before(tableRow);

      return false;
    });

    $(container + ' .tbody').on("click", "i", function () {
      $(this).parent().parent().remove();
    });

    $(container + " " + modalname).modal({ 'show': true, "backdrop": true });
  }

</script>